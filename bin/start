#!/usr/bin/env bash

set -e

if [[ -z "$1" ]]; then
  formatted_date=$(date "+%Y/%d")

  year=$(date "+%Y")
  day=$(date "+%-d")
  day_0=$(date "+%d")
else
  [[ $1 =~ ^[0-9]{4}\/[0-9]{2}$ ]] || (echo "invalid format, use bin/start YYYY/DD" && exit 1)

  formatted_date="$1"
  year=$(echo "$1" | awk '{ split($0, a, "/"); print a[1] }' )
  day_0=$(echo "$1" | awk '{ split($0, a, "/"); print a[2] }' )
  day=$(echo "$day_0" | sed 's/^0*//')
fi

directory="lib/$formatted_date"

[[ -d "$directory" ]] || mkdir -p "$directory"
[[ -f "$directory/solution.rb" ]] || touch "$directory/solution.rb"

if [[ -f .cookie ]]; then
  input_directory="inputs/$year"

  [[ -d "$input_directory" ]] || mkdir -p "$input_directory"

  cookie=$(<.cookie)
  uri="https://adventofcode.com/$year/day/$day/input"
  input=$(curl --silent --cookie "$cookie" "$uri")
  input_path="$input_directory/$day_0.txt"

  echo "$input" > "$input_path"
fi

echo "https://adventofcode.com/$year/day/$day"
echo "gl hf"
